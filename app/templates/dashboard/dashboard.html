{% extends 'layout.html' %}
{% from 'bootstrap5/table.html' import render_table %}
{% from 'bootstrap5/pagination.html' import render_pager, render_pagination %}

{% block content %}
<div class="dashboard">
        <div class="container">
            <div class="toprow pt-5">
                <div class="row">
                    <div class="col-lg-6">
                        <h1 class="cardtitle">Latest POAM Results Count</h1>
                        <div class="card">
                            <div class="card-body text-center">
                                <div class="row">
                                    <div class="col">
                                        <h2 class="mt-3">{{ highs }}</h2>
                                    </div>
                                    <div class="col">
                                        <h2 class="mt-3">{{ meds }}</h2>
                                    </div>
                                    <div class="col">
                                        <h2 class="mt-3">{{ lows }}</h2>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col">
                                        <h2 class="mt-1">High</h2>
                                    </div>
                                    <div class="col">
                                        <h2 class="mt-1">Medium</h2>
                                    </div>
                                    <div class="col">
                                        <h2 class="mt-1">Low</h2>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <h1 class="cardtitle">Latest POAM Results Status Count</h1>
                        <div class="card">
                            <div class="card-body text-center">
                                <div class="row">
                                    <div class="col">
                                        <h2 class="mt-3">{{ hsla }}</h2>
                                    </div>
                                    <div class="col">
                                        <h2 class="mt-3">{{ msla }}</h2>
                                    </div>
                                    <div class="col">
                                        <h2 class="mt-3">{{ lsla }}</h2>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col">
                                        <h2 class="mt-1">High over 30 days</h2>
                                    </div>
                                    <div class="col">
                                        <h2 class="mt-1">Medium over 90 days</h2>
                                    </div>
                                    <div class="col">
                                        <h2 class="mt-1">Low over 180 days</h2>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="bottomrow pt-5">
                <div class="row">
                    <div class="col-lg-6">
                        <h1 class="cardtitle">Issues last 7 days</h1>
                        <div class="card">
                            <div class="card-body">
                                {{ render_table(recent_poams, titles, table_classes='table table-dark table-hover') }}
                                {{ render_pager(pagination, align='right') }}
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <h1 class="cardtitle">POAM Trend Graph (6 Months)</h1>
                        <div class="card chartcard">
                            <div class="card-body text-center">
                                <canvas id="trendChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/chart.min.js') }}"></script>
<script>
var ctxL = document.getElementById("trendChart").getContext('2d');
var theTrendChart = new Chart(ctxL, {
    type: 'line',
    data: {
        labels: [{% for item in months %}
                  "{{item}}",
              {% endfor %}],
        datasets: [{
            label: "High",
            data: [{% for item in chartHigh %}
                  "{{item}}",
              {% endfor %}],
            backgroundColor: [
                'rgba(247, 62, 62, .2)',
            ],
            borderColor: [
                'rgba(247, 62, 62, .3)',
            ],
            borderWidth: 6
        },
        {
            label: "Medium",
            data: [{% for item in chartMed %}
                  "{{item}}",
              {% endfor %}],
            backgroundColor: [
                'rgba(255, 246, 123, .2)',
            ],
            borderColor: [
                'rgba(255, 246, 123, .3)',
            ],
            borderWidth: 6
        },
        {
            label: "Low",
            data: [{% for item in chartLow %}
                  "{{item}}",
              {% endfor %}],
            backgroundColor: [
                'rgba(123, 185, 255, .2)',
            ],
            borderColor: [
                'rgba(123, 185, 255, .3)',
            ],
            borderWidth: 6
        }
        ]
    },
    options: {
        responsive: true
    }
});
</script>
{% endblock %}